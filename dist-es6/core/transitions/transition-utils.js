import { mod } from '../utils/math-utils';

var VIEWPORT_PROPS = ['width', 'height', 'longitude', 'latitude', 'zoom', 'bearing', 'pitch', 'position'];

var WRAPPED_ANGULAR_PROPS = {
  longitude: 1,
  bearing: 1
};

export function lerp(start, end, step) {
  if (Array.isArray(start)) {
    return start.map(function (element, index) {
      return lerp(element, end[index], step);
    });
  }
  return step * end + (1 - step) * start;
}

export function isValid(prop) {
  return Number.isFinite(prop) || Array.isArray(prop);
}

function isWrappedAngularProp(propName) {
  return WRAPPED_ANGULAR_PROPS[propName];
}

export function getEndValueByShortestPath(propName, startValue, endValue) {
  if (isWrappedAngularProp(propName) && Math.abs(endValue - startValue) > 180) {
    endValue = endValue < 0 ? endValue + 360 : endValue - 360;
  }
  return endValue;
}

// TODO/xiaoji: This should be merged with the controller's prop constraint system
export function extractViewportFrom(props) {
  var viewport = {};
  VIEWPORT_PROPS.forEach(function (key) {
    var value = props[key];
    if (isValid(value)) {
      viewport[key] = value;
      // Normalize longitude and bearing into [-180, 180) range
      // This gurantees the props are in same range when they are interpolated.
      if (isWrappedAngularProp(key)) {
        viewport[key] = mod(value + 180, 360) - 180;
      }
    }
  });
  return viewport;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb3JlL3RyYW5zaXRpb25zL3RyYW5zaXRpb24tdXRpbHMuanMiXSwibmFtZXMiOlsibW9kIiwiVklFV1BPUlRfUFJPUFMiLCJXUkFQUEVEX0FOR1VMQVJfUFJPUFMiLCJsb25naXR1ZGUiLCJiZWFyaW5nIiwibGVycCIsInN0YXJ0IiwiZW5kIiwic3RlcCIsIkFycmF5IiwiaXNBcnJheSIsIm1hcCIsImVsZW1lbnQiLCJpbmRleCIsImlzVmFsaWQiLCJwcm9wIiwiTnVtYmVyIiwiaXNGaW5pdGUiLCJpc1dyYXBwZWRBbmd1bGFyUHJvcCIsInByb3BOYW1lIiwiZ2V0RW5kVmFsdWVCeVNob3J0ZXN0UGF0aCIsInN0YXJ0VmFsdWUiLCJlbmRWYWx1ZSIsIk1hdGgiLCJhYnMiLCJleHRyYWN0Vmlld3BvcnRGcm9tIiwicHJvcHMiLCJ2aWV3cG9ydCIsImZvckVhY2giLCJrZXkiLCJ2YWx1ZSJdLCJtYXBwaW5ncyI6IkFBQUEsU0FBUUEsR0FBUixRQUFrQixxQkFBbEI7O0FBRUEsSUFBTUMsaUJBQ0osQ0FBQyxPQUFELEVBQVUsUUFBVixFQUFvQixXQUFwQixFQUFpQyxVQUFqQyxFQUE2QyxNQUE3QyxFQUFxRCxTQUFyRCxFQUFnRSxPQUFoRSxFQUF5RSxVQUF6RSxDQURGOztBQUdBLElBQU1DLHdCQUF3QjtBQUM1QkMsYUFBVyxDQURpQjtBQUU1QkMsV0FBUztBQUZtQixDQUE5Qjs7QUFLQSxPQUFPLFNBQVNDLElBQVQsQ0FBY0MsS0FBZCxFQUFxQkMsR0FBckIsRUFBMEJDLElBQTFCLEVBQWdDO0FBQ3JDLE1BQUlDLE1BQU1DLE9BQU4sQ0FBY0osS0FBZCxDQUFKLEVBQTBCO0FBQ3hCLFdBQU9BLE1BQU1LLEdBQU4sQ0FBVSxVQUFDQyxPQUFELEVBQVVDLEtBQVYsRUFBb0I7QUFDbkMsYUFBT1IsS0FBS08sT0FBTCxFQUFjTCxJQUFJTSxLQUFKLENBQWQsRUFBMEJMLElBQTFCLENBQVA7QUFDRCxLQUZNLENBQVA7QUFHRDtBQUNELFNBQU9BLE9BQU9ELEdBQVAsR0FBYSxDQUFDLElBQUlDLElBQUwsSUFBYUYsS0FBakM7QUFDRDs7QUFFRCxPQUFPLFNBQVNRLE9BQVQsQ0FBaUJDLElBQWpCLEVBQXVCO0FBQzVCLFNBQU9DLE9BQU9DLFFBQVAsQ0FBZ0JGLElBQWhCLEtBQXlCTixNQUFNQyxPQUFOLENBQWNLLElBQWQsQ0FBaEM7QUFDRDs7QUFFRCxTQUFTRyxvQkFBVCxDQUE4QkMsUUFBOUIsRUFBd0M7QUFDdEMsU0FBT2pCLHNCQUFzQmlCLFFBQXRCLENBQVA7QUFDRDs7QUFFRCxPQUFPLFNBQVNDLHlCQUFULENBQW1DRCxRQUFuQyxFQUE2Q0UsVUFBN0MsRUFBeURDLFFBQXpELEVBQW1FO0FBQ3hFLE1BQUlKLHFCQUFxQkMsUUFBckIsS0FBa0NJLEtBQUtDLEdBQUwsQ0FBU0YsV0FBV0QsVUFBcEIsSUFBa0MsR0FBeEUsRUFBNkU7QUFDM0VDLGVBQVlBLFdBQVcsQ0FBWixHQUFpQkEsV0FBVyxHQUE1QixHQUFrQ0EsV0FBVyxHQUF4RDtBQUNEO0FBQ0QsU0FBT0EsUUFBUDtBQUNEOztBQUVEO0FBQ0EsT0FBTyxTQUFTRyxtQkFBVCxDQUE2QkMsS0FBN0IsRUFBb0M7QUFDekMsTUFBTUMsV0FBVyxFQUFqQjtBQUNBMUIsaUJBQWUyQixPQUFmLENBQXVCLFVBQUNDLEdBQUQsRUFBUztBQUM5QixRQUFNQyxRQUFRSixNQUFNRyxHQUFOLENBQWQ7QUFDQSxRQUFJZixRQUFRZ0IsS0FBUixDQUFKLEVBQW9CO0FBQ2xCSCxlQUFTRSxHQUFULElBQWdCQyxLQUFoQjtBQUNBO0FBQ0E7QUFDQSxVQUFJWixxQkFBcUJXLEdBQXJCLENBQUosRUFBK0I7QUFDN0JGLGlCQUFTRSxHQUFULElBQWdCN0IsSUFBSThCLFFBQVEsR0FBWixFQUFpQixHQUFqQixJQUF3QixHQUF4QztBQUNEO0FBQ0Y7QUFDRixHQVZEO0FBV0EsU0FBT0gsUUFBUDtBQUNEIiwiZmlsZSI6InRyYW5zaXRpb24tdXRpbHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge21vZH0gZnJvbSAnLi4vdXRpbHMvbWF0aC11dGlscyc7XG5cbmNvbnN0IFZJRVdQT1JUX1BST1BTID1cbiAgWyd3aWR0aCcsICdoZWlnaHQnLCAnbG9uZ2l0dWRlJywgJ2xhdGl0dWRlJywgJ3pvb20nLCAnYmVhcmluZycsICdwaXRjaCcsICdwb3NpdGlvbiddO1xuXG5jb25zdCBXUkFQUEVEX0FOR1VMQVJfUFJPUFMgPSB7XG4gIGxvbmdpdHVkZTogMSxcbiAgYmVhcmluZzogMVxufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGxlcnAoc3RhcnQsIGVuZCwgc3RlcCkge1xuICBpZiAoQXJyYXkuaXNBcnJheShzdGFydCkpIHtcbiAgICByZXR1cm4gc3RhcnQubWFwKChlbGVtZW50LCBpbmRleCkgPT4ge1xuICAgICAgcmV0dXJuIGxlcnAoZWxlbWVudCwgZW5kW2luZGV4XSwgc3RlcCk7XG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIHN0ZXAgKiBlbmQgKyAoMSAtIHN0ZXApICogc3RhcnQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1ZhbGlkKHByb3ApIHtcbiAgcmV0dXJuIE51bWJlci5pc0Zpbml0ZShwcm9wKSB8fCBBcnJheS5pc0FycmF5KHByb3ApO1xufVxuXG5mdW5jdGlvbiBpc1dyYXBwZWRBbmd1bGFyUHJvcChwcm9wTmFtZSkge1xuICByZXR1cm4gV1JBUFBFRF9BTkdVTEFSX1BST1BTW3Byb3BOYW1lXTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEVuZFZhbHVlQnlTaG9ydGVzdFBhdGgocHJvcE5hbWUsIHN0YXJ0VmFsdWUsIGVuZFZhbHVlKSB7XG4gIGlmIChpc1dyYXBwZWRBbmd1bGFyUHJvcChwcm9wTmFtZSkgJiYgTWF0aC5hYnMoZW5kVmFsdWUgLSBzdGFydFZhbHVlKSA+IDE4MCkge1xuICAgIGVuZFZhbHVlID0gKGVuZFZhbHVlIDwgMCkgPyBlbmRWYWx1ZSArIDM2MCA6IGVuZFZhbHVlIC0gMzYwO1xuICB9XG4gIHJldHVybiBlbmRWYWx1ZTtcbn1cblxuLy8gVE9ETy94aWFvamk6IFRoaXMgc2hvdWxkIGJlIG1lcmdlZCB3aXRoIHRoZSBjb250cm9sbGVyJ3MgcHJvcCBjb25zdHJhaW50IHN5c3RlbVxuZXhwb3J0IGZ1bmN0aW9uIGV4dHJhY3RWaWV3cG9ydEZyb20ocHJvcHMpIHtcbiAgY29uc3Qgdmlld3BvcnQgPSB7fTtcbiAgVklFV1BPUlRfUFJPUFMuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgY29uc3QgdmFsdWUgPSBwcm9wc1trZXldO1xuICAgIGlmIChpc1ZhbGlkKHZhbHVlKSkge1xuICAgICAgdmlld3BvcnRba2V5XSA9IHZhbHVlO1xuICAgICAgLy8gTm9ybWFsaXplIGxvbmdpdHVkZSBhbmQgYmVhcmluZyBpbnRvIFstMTgwLCAxODApIHJhbmdlXG4gICAgICAvLyBUaGlzIGd1cmFudGVlcyB0aGUgcHJvcHMgYXJlIGluIHNhbWUgcmFuZ2Ugd2hlbiB0aGV5IGFyZSBpbnRlcnBvbGF0ZWQuXG4gICAgICBpZiAoaXNXcmFwcGVkQW5ndWxhclByb3Aoa2V5KSkge1xuICAgICAgICB2aWV3cG9ydFtrZXldID0gbW9kKHZhbHVlICsgMTgwLCAzNjApIC0gMTgwO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIHJldHVybiB2aWV3cG9ydDtcbn1cbiJdfQ==